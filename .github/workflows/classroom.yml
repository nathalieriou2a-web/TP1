name: Autograding Tests

on:
  - push
  - repository_dispatch

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Compilation
        id: compilation
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: Compilation
          command: gcc -std=c99 -Wall -Wextra main.c -o prog
          timeout: 10
          max-score: 2

      - name: Test positif
        id: q1_positif
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: Valeur strictement positive
          command: |
            gcc -std=c99 -Wall -Wextra main.c -o prog &&
            result=$(echo 5 | ./prog | tr -d '\r\n ') &&
            [ "$result" = "POSITIF" ]
          timeout: 10
          max-score: 4

      - name: Test negatif
        id: q2_negatif
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: Valeur strictement negative
          command: |
            gcc -std=c99 -Wall -Wextra main.c -o prog &&
            result=$(echo -3 | ./prog | tr -d '\r\n ') &&
            [ "$result" = "NEGATIF" ]
          timeout: 10
          max-score: 4

      - name: Test nul
        id: q3_nul
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: Valeur nulle
          command: |
            gcc -std=c99 -Wall -Wextra main.c -o prog &&
            result=$(echo 0 | ./prog | tr -d '\r\n ') &&
            [ "$result" = "POSITIF" ]
          timeout: 10
          max-score: 2

      - name: Autograding Reporter
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          COMPILATION_RESULTS: ${{ steps.compilation.outputs.result }}
          Q1_POSITIF_RESULTS: ${{ steps.q1_positif.outputs.result }}
          Q2_NEGATIF_RESULTS: ${{ steps.q2_negatif.outputs.result }}
          Q3_NUL_RESULTS: ${{ steps.q3_nul.outputs.result }}
        with:
          runners: compilation,q1_positif,q2_negatif,q3_nul
